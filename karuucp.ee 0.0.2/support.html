<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Breaking San Andreas - Support</title>
  <link rel="icon" href="assets/bsa.png" type="image/png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
  />
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;500;600;700&display=swap");
    body {
      font-family: "Nunito", sans-serif;
      background: #fafafa;
      color: #1f2937;
      transition: background-color 0.3s, color 0.3s;
      overflow: hidden;
    }
    [data-theme="dark"] {
      background: #1f2937;
      color: #fafafa;
    }
    .nav-link {
      cursor: pointer;
      display: block;
      padding: 0.5rem 0;
      color: #eee;
      font-weight: 600;
    }
    /* Scroll container */
    #content {
      max-height: 70vh;
      overflow-y: auto;
    }
    /* Scrollbar styling */
    #content::-webkit-scrollbar {
      width: 8px;
    }
    #content::-webkit-scrollbar-track {
      background: transparent;
    }
    #content::-webkit-scrollbar-thumb {
      background-color: #3b82f6;
      border-radius: 4px;
    }
  </style>
</head>

<body class="bg-[#fafafa] text-gray-900 transition-colors duration-300" data-theme="light">
  <!-- Notification -->
  <div
    id="notification"
    class="fixed top-4 right-4 z-50 hidden text-white px-4 py-2 rounded shadow-lg transition-opacity duration-300"
  ></div>

  <div class="flex min-h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-[#1f2937] text-white p-6">
      <h1 class="text-2xl font-bold mb-6" style="font-family: 'Nunito';">
        Breaking SA
      </h1>
      <nav class="space-y-1">

<a href="index.html" 
   class="nav-link block text-white bg-transparent rounded-md px-3 py-2 font-semibold relative left-[-16px] hover:bg-gray-700 flex items-center gap-2"
   style="font-family: 'Nunito'; width: 238px; font-size: 14px;"
>
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
       stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round"
          d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
  </svg>

  Avaleht
</a>


<a href="profile.html" 
   class="nav-link block text-white bg-transparent rounded-md px-3 py-2 font-semibold relative left-[-16px] hover:bg-gray-700 flex items-center gap-2"
   style="font-family: 'Nunito'; width: 238px; font-size: 14px;"
>
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
       stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round"
          d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
  </svg>
  
  Profiil
</a>

</a>
  <a href="rules.html" class="nav-link block text-white bg-transparent rounded-md px-3 py-2 font-semibold relative left-[-16px] hover:bg-gray-700 flex items-center gap-2" style="font-family: 'Nunito'; width: 238px; font-size: 14px;">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
       stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round"
          d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" />
  </svg></i>Reeglid
</a>

<a href="media.html" 
   class="nav-link block text-white bg-transparent rounded-md px-3 py-2 font-semibold relative left-[-16px] hover:bg-gray-700 flex items-center gap-2"
   style="font-family: 'Nunito'; width: 238px; font-size: 14px;"
>
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
       stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round"
          d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
  </svg>

  Meedia
</a>

<a href="patchnotes.html" 
   class="nav-link block text-white bg-transparent rounded-md px-3 py-2 font-semibold relative left-[-16px] hover:bg-gray-700 flex items-center gap-2"
   style="font-family: 'Nunito'; width: 238px; font-size: 14px;"
>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
       stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round"
          d="m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z" />
  </svg>

  Uuendused
</a>

<a href="support.html" 
   class="nav-link block text-white bg-transparent rounded-md px-3 py-2 font-semibold relative left-[-16px] hover:bg-gray-700 flex items-center gap-2"
   style="font-family: 'Nunito'; width: 238px; font-size: 14px;"
>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
       stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round"
          d="M3 3v1.5M3 21v-6m0 0 2.77-.693a9 9 0 0 1 6.208.682l.108.054a9 9 0 0 0 6.086.71l3.114-.732a48.524 48.524 0 0 1-.005-10.499l-3.11.732a9 9 0 0 1-6.085-.711l-.108-.054a9 9 0 0 0-6.208-.682L3 4.5M3 15V4.5" />
  </svg>

  Support
</a>

<a href="history.html" 
   class="nav-link block text-white bg-transparent rounded-md px-3 py-2 font-semibold relative left-[-16px] hover:bg-gray-700 flex items-center gap-2"
   style="font-family: 'Nunito'; width: 238px; font-size: 14px;"
>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
       stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round"
          d="M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 0 0-1.883 2.542l.857 6a2.25 2.25 0 0 0 2.227 1.932H19.05a2.25 2.25 0 0 0 2.227-1.932l.857-6a2.25 2.25 0 0 0-1.883-2.542m-16.5 0V6A2.25 2.25 0 0 1 6 3.75h3.879a1.5 1.5 0 0 1 1.06.44l2.122 2.12a1.5 1.5 0 0 0 1.06.44H18A2.25 2.25 0 0 1 20.25 9v.776" />
  </svg>

  Ajalugu
</a>

<a href="settings.html" 
   class="nav-link block text-white bg-transparent rounded-md px-3 py-2 font-semibold relative left-[-16px] hover:bg-gray-700 flex items-center gap-2"
   style="font-family: 'Nunito'; width: 238px; font-size: 14px;"
>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
       stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round"
          d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 0 1 1.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.107 1.204.165.397.505.71.93.78l.893.15c.543.09.94.559.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.894.149c-.424.07-.764.383-.929.78-.165.398-.143.854.107 1.204l.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 0 1-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.398.165-.71.505-.781.929l-.149.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.019-.398-1.11-.94l-.148-.894c-.071-.424-.384-.764-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 0 1-.12-1.45l.527-.737c.25-.35.272-.806.108-1.204-.165-.397-.506-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.109v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.108-1.204l-.526-.738a1.125 1.125 0 0 1 .12-1.45l.773-.773a1.125 1.125 0 0 1 1.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894Z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
  </svg>

  Seaded
</a>
</nav>

<h3 class="pt-4 pb-1 px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider">Pood</h3>

<a href="shop.html" 
   class="nav-link block text-white bg-transparent rounded-md px-3 py-2 font-semibold relative left-[-16px] hover:bg-gray-700 flex items-center gap-2"
   style="font-family: 'Nunito'; width: 238px; font-size: 14px;"
>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
       stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round"
          d="M2.25 18.75a60.07 60.07 0 0 1 15.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 0 1 3 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 0 0-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 0 1-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 0 0 3 15h-.75M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm3 0h.008v.008H18V10.5Zm-12 0h.008v.008H6V10.5Z" />
  </svg>
  
  Coinid
</a>
<a href="vip.html" 
   class="nav-link block text-white bg-transparent rounded-md px-3 py-2 font-semibold relative left-[-16px] hover:bg-gray-700 flex items-center gap-2"
   style="font-family: 'Nunito'; width: 238px; font-size: 14px;"
>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
       stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round"
          d="M2.25 18.75a60.07 60.07 0 0 1 15.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 0 1 3 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 0 0-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 0 1-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 0 0 3 15h-.75M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm3 0h.008v.008H18V10.5Zm-12 0h.008v.008H6V10.5Z" />
  </svg>
  
  Paketid
</a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-10 overflow-auto">
      <div
        id="main-container"
        class="bg-white dark:bg-[#1f2937] dark:text-white rounded-md shadow p-8 relative min-h-[600px]"
      >
        <h2 class="text-3xl font-semibold mb-6">Tugi</h2>

        <!-- Ticket creation form -->
        <form id="ticketForm" class="mb-8 max-w-lg">
          <label class="block mb-2 font-semibold" for="title">Päis (lühike kirjeldus)</label>
          <input
            id="title"
            type="text"
            required
            class="w-full rounded border border-gray-300 px-3 py-2 mb-4 text-gray-900"
            placeholder="Kirjuta siia, mis põhjusel ticket tehakse"
          />

          <label class="block mb-2 font-semibold" for="description">Kirjeldus</label>
          <textarea
            id="description"
            required
            class="w-full rounded border border-gray-300 px-3 py-2 mb-4 text-gray-900"
            placeholder="Kirjelda probleemi või küsimust põhjalikumalt"
            rows="5"
          ></textarea>

          <button
            type="submit"
            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-semibold"
          >
            Loo ticket
          </button>
        </form>

        <!-- List of user's tickets -->
        <h3 class="text-2xl font-semibold mb-4">Sinu ticketid</h3>
        <div id="ticketsList" class="space-y-4 max-w-3xl overflow-auto max-h-[350px]"></div>

        <!-- Ticket conversation modal -->
        <div
          id="ticketModal"
          class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center hidden"
        >
          <div
            class="bg-white dark:bg-[#1f2937] rounded-md shadow-lg w-full max-w-3xl max-h-[80vh] flex flex-col"
          >
            <div
              class="flex justify-between items-center border-b border-gray-200 dark:border-gray-600 p-4"
            >
              <h4 id="modalTitle" class="text-xl font-semibold"></h4>
              <button
                id="closeModalBtn"
                class="text-gray-700 dark:text-gray-300 hover:text-red-600 text-2xl font-bold"
                title="Sulge"
              >
                &times;
              </button>
            </div>
            <div
              id="modalContent"
              class="flex-1 p-4 overflow-y-auto space-y-4 text-gray-800 dark:text-gray-200"
            ></div>
            <form id="replyForm" class="p-4 border-t border-gray-200 dark:border-gray-600 flex space-x-4">
              <input
                id="replyInput"
                type="text"
                placeholder="Kirjuta vastus..."
                required
                class="flex-1 rounded border border-gray-300 px-3 py-2 text-gray-900"
              />
              <button
                type="submit"
                class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-semibold"
              >
                Saada
              </button>
            </form>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Check user login
    let user = JSON.parse(localStorage.getItem("user"));
    if (!user || !user.email) {
      window.location.href = "login.html";
    }

    // Notification system
    function showNotification(message, type = "info") {
      const notification = document.getElementById("notification");
      notification.textContent = message;

      const colors = {
        info: "bg-gray-900",
        success: "bg-green-600",
        error: "bg-red-600",
        warning: "bg-yellow-500",
      };

      notification.className = `fixed top-4 right-4 z-50 text-white px-4 py-2 rounded shadow-lg transition-opacity duration-300 ${colors[type]}`;
      notification.style.opacity = "1";
      notification.classList.remove("hidden");

      setTimeout(() => {
        notification.style.opacity = "0";
        setTimeout(() => notification.classList.add("hidden"), 300);
      }, 3000);
    }

    // Utils
    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).slice(2);
    }

    // Load tickets from localStorage or initialize
    function loadTickets() {
      const tickets = JSON.parse(localStorage.getItem("tickets")) || [];
      return tickets;
    }

    // Save tickets
    function saveTickets(tickets) {
      localStorage.setItem("tickets", JSON.stringify(tickets));
    }

    // Render user tickets
    function renderUserTickets() {
      const tickets = loadTickets();
      const userTickets = tickets.filter(t => t.userEmail === user.email);
      const container = document.getElementById("ticketsList");
      container.innerHTML = "";

      if (userTickets.length === 0) {
        container.innerHTML = '<p class="text-gray-600 dark:text-gray-400">Sul pole ühtegi ticketit.</p>';
        return;
      }

      userTickets.forEach(ticket => {
        const ticketEl = document.createElement("div");
        ticketEl.className = "border rounded p-4 shadow-sm hover:shadow-md cursor-pointer bg-gray-50 dark:bg-[#374151]";
        ticketEl.innerHTML = `
          <div class="flex justify-between items-center mb-2">
            <h4 class="font-semibold text-lg">${ticket.title}</h4>
            <span class="text-sm font-medium px-2 py-1 rounded ${
              ticket.status === "Closed" ? "bg-red-600" : "bg-green-600"
            } text-white">${ticket.status}</span>
          </div>
          <p class="text-gray-700 dark:text-gray-300 mb-2">${ticket.description.substring(0, 100)}${ticket.description.length > 100 ? "..." : ""}</p>
          <small class="text-gray-500 dark:text-gray-400">Loodud: ${new Date(ticket.createdAt).toLocaleString()}</small>
        `;
        ticketEl.addEventListener("click", () => openTicketModal(ticket.id));
        container.appendChild(ticketEl);
      });
    }

    // Modal logic
    const ticketModal = document.getElementById("ticketModal");
    const modalTitle = document.getElementById("modalTitle");
    const modalContent = document.getElementById("modalContent");
    const replyForm = document.getElementById("replyForm");
    const replyInput = document.getElementById("replyInput");
    const closeModalBtn = document.getElementById("closeModalBtn");

    let currentTicketId = null;

    function openTicketModal(ticketId) {
      const tickets = loadTickets();
      const ticket = tickets.find(t => t.id === ticketId);

      if (!ticket) {
        showNotification("Ticketit ei leitud", "error");
        return;
      }

      // Only owner or admin can open
      if (ticket.userEmail !== user.email) {
        showNotification("Sul puudub juurdepääs selle ticketi vaatamiseks", "error");
        return;
      }

      currentTicketId = ticketId;
      modalTitle.textContent = `${ticket.title} (${ticket.status})`;

      renderConversation(ticket.conversation);

      ticketModal.classList.remove("hidden");
      replyInput.focus();
    }

    // Render conversation in modal
    function renderConversation(conversation) {
      modalContent.innerHTML = "";
      conversation.forEach((msg) => {
        const isUser = msg.author === user.email;
        const msgDiv = document.createElement("div");
        msgDiv.className = `p-3 rounded max-w-[75%] ${
          isUser ? "bg-blue-600 text-white ml-auto" : "bg-gray-300 dark:bg-gray-700 text-gray-900 dark:text-white"
        }`;
        msgDiv.textContent = msg.message;
        modalContent.appendChild(msgDiv);

        const timeDiv = document.createElement("div");
        timeDiv.className = "text-xs text-gray-500 dark:text-gray-400 mt-1";
        timeDiv.style.textAlign = isUser ? "right" : "left";
        timeDiv.textContent = new Date(msg.timestamp).toLocaleString();
        modalContent.appendChild(timeDiv);
      });
      modalContent.scrollTop = modalContent.scrollHeight;
    }

    closeModalBtn.addEventListener("click", () => {
      ticketModal.classList.add("hidden");
      currentTicketId = null;
      replyInput.value = "";
    });

    replyForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const message = replyInput.value.trim();
      if (!message) return;

      let tickets = loadTickets();
      const ticket = tickets.find(t => t.id === currentTicketId);
      if (!ticket) {
        showNotification("Ticketit ei leitud", "error");
        return;
      }

      // Add reply from user
      ticket.conversation.push({
        author: user.email,
        message,
        timestamp: Date.now(),
      });

      saveTickets(tickets);
      renderConversation(ticket.conversation);
      replyInput.value = "";
    });

    // Ticket creation form
    const ticketForm = document.getElementById("ticketForm");
    ticketForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const title = ticketForm.title.value.trim();
      const description = ticketForm.description.value.trim();
      if (!title || !description) return;

      let tickets = loadTickets();
      const newTicket = {
        id: generateId(),
        userEmail: user.email,
        title,
        description,
        status: "Open",
        createdAt: Date.now(),
        conversation: [
          {
            author: user.email,
            message: description,
            timestamp: Date.now(),
          },
        ],
      };
      tickets.push(newTicket);
      saveTickets(tickets);
      ticketForm.reset();
      showNotification("Ticket loodud edukalt", "success");
      renderUserTickets();
    });

    // Initial load
    renderUserTickets();

    // Dark/light mode toggle (optional if you want)
    // Example: Add a button to toggle data-theme="dark" or "light"
  document.addEventListener('DOMContentLoaded', () => {
    const currentUrl = window.location.pathname.split('/').pop();
    document.querySelectorAll('.nav-link').forEach(link => {
      const linkUrl = link.getAttribute('href');
      if (linkUrl === currentUrl) {
        link.classList.add('bg-gray-900', 'text-white', 'font-semibold');
        link.classList.remove('bg-transparent');
      } else {
        link.classList.remove('bg-gray-900', 'font-semibold');
        link.classList.add('bg-transparent', 'text-white');
      }
    });
  });
  </script>
</body>
</html>
